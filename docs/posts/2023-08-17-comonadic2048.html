<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Allan Wei's Blog</title>
        <link rel="stylesheet" href="../css/default.css" />
        <link rel="stylesheet" href="../css/syntax.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <img src="../images/wei-logo.svg" style="width:50%; max-width:80px; display: block; margin-left: auto; margin-right: auto;" />
                <a href="../">The Wei Zone</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Blogs</a>
            </nav>
        </header>

        <main role="main">
            <h1>2048 Using Comoands (The Ascended Way?)</h1>
            <article>
    <section class="header">
        <p>Posted on August 17, 2023</p><br>
        
    </section>
    <section>
        <p>2048 is a popular single-player puzzle game where the goal is to merge tiles with the same power of 2 until you reach 2048. Since the game is conceptually quite simple it will be a good example to demonstrate some lesser used techniques based on category theory. There are several existing implementations of 2048 in Haskell (such as <a href="https://github.com/gregorulm/h2048">this</a> and <a href="https://github.com/Javran/h2048">this</a>), however, they use a more direct method of repersenting the board state. In this article I will use Comoands to repersent the board state, and go through the category theory background and the step-by-step implementation, and why we would want to use a Comoand in the first place.</p>
<h1 id="what-is-a-comoand-anyways">What is a Comoand anyways?</h1>
<p>Comoands are a concept from category theory that can be used to model contextual computations in functional programming. Comonads are the dual of Monads, the dual just means to switch the arrows. While Monads are about adding extra context or effects to a computation, Comoands are about extracting values or information from a context.The core essence of a Comoand is that it is a container that holds values and provides a way to access them.</p>
<p>Let’s construct a Comoand by reversing the arrows of the Monad! Here we can see our Monad class that we’re familiar with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">Functor</span> m <span class="ot">=&gt;</span> <span class="dt">Monad</span> m <span class="kw">where</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ot">  return ::</span> a <span class="ot">-&gt;</span> m a</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ot">  join ::</span> m (m a) <span class="ot">-&gt;</span> m a</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ot">  bind ::</span> (a <span class="ot">-&gt;</span> m b) <span class="ot">-&gt;</span> m a <span class="ot">-&gt;</span> m b</span></code></pre></div>
<p>Here’s what happens when we reverse them:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">Functor</span> w <span class="ot">=&gt;</span> <span class="dt">Comoand</span> w <span class="kw">where</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ot">  coreturn ::</span> w a <span class="ot">-&gt;</span> a</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ot">  cojoin ::</span> w a <span class="ot">-&gt;</span> w (w a)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ot">  cobind ::</span> (w a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> w a <span class="ot">-&gt;</span> w b</span></code></pre></div>
<p>I’ve named prefixed co- to each function so that you can clearly see the connection however, more often they are named like this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">Functor</span> w <span class="ot">=&gt;</span> <span class="dt">Comoand</span> w <span class="kw">where</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ot">  extract ::</span> w a <span class="ot">-&gt;</span> a</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ot">  duplicate ::</span> w a <span class="ot">-&gt;</span> w (w a)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ot">  extend ::</span> (w a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> w a <span class="ot">-&gt;</span> w b</span></code></pre></div>
<p>Notice that the functor requirement for the Monad also applies to the Comoand as well. Already this allows us to use our good friend <code>fmap</code>. Many common programming constructs, such as streams and zippers, can be considered as a Comoand, but for our implementation I will use this data type:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Store</span> s a <span class="ot">=</span> <span class="dt">Store</span> (s <span class="ot">-&gt;</span> a) s</span></code></pre></div>
<p>This is known as the Store Comoand. Let’s break down this data type and implement the Comoand instance for it.</p>
    </section>
</article>
        </main>

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
